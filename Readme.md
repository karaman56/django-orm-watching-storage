 # Пульт охраны банка

Это внутренний репозиторий для сотрудников банка "Рога и Копыта". Если Вы попали в этот репозиторий случайно, то Вы не сможете подключиться к БД, так как у Вас нет доступа, но Вы сможете посмотреть, как реализованы запросы к БД.

Пульт охраны - это сайт, который может подключиться удаленно к базе данных с визитами и карточками доступа нашего банка.

## Как установить

1. Необходимо скачать репозиторий по ссылке: [https://github.com/karaman56/django-orm-watching-storage](https://github.com/karaman56/django-orm-watching-storage)  
2. Python 3 должен быть уже установлен.  
3. Затем используйте команду <span style="color: red;">`pip install -r requirements.txt`</span> для установки зависимостей.
4. Настройте переменные окружения, указав параметры подключения к базе данных в файле `.env`.

## Переменные окружения

Для корректной работы приложения необходимо настроить следующие переменные окружения в файле `.env`:

- `DEBUG`: (bool) Включение режима отладки. По умолчанию `False`.
- `DB_ENGINE`: (str) Движок базы данных (например, `django.db.backends.postgresql`).
- `DB_HOST`: (str) Хост базы данных (например, `localhost`).
- `DB_PORT`: (int) Порт базы данных (например, `5432`).
- `DB_NAME`: (str) Имя базы данных.
- `DB_USER`: (str) Имя пользователя для подключения к базе данных.
- `DB_PASSWORD`: (str) Пароль для подключения к базе данных.
- `SECRET_KEY`: (str) Секретный ключ для вашего Django приложения. Необходимо заменить на уникальное значение.

Пример файла `.env`:


## Использование

1. Запустите сервер разработки:

   ```bash
   python manage.py runserver
   ```

2. Перейдите по адресу `http://127.0.0.1:8000/` в вашем веб-браузере.

## Функциональность

- **Информация о карточках доступа**: Просмотр активных карточек доступа и их владельцев.
- **Визиты**: Отображение информации о визитах, включая время входа и выхода, а также продолжительность визита.
- **Долгие визиты**: Визиты, которые превышают 1 час.

## Структура проекта

- `models.py`: Определение моделей `Passcard` и `Visit`.
- `views.py`: Логика представлений для отображения информации о карточках и визитах.
- `utils.py`: Утилиты для работы с продолжительностью визитов.
- `settings.py`: Настройки проекта, включая параметры подключения к базе данных.

### Представления (Views)

#### 1. `active_passcards_view`

- **Описание**: Это представление отображает список всех активных карточек доступа и их владельцев. Оно фильтрует карточки по статусу `is_active=True` и передает данные в шаблон для отображения.
- **URL**: `/`
- **Контекст**:
  - `active_passcards`: Список активных карточек доступа.
  - `active_passcards_count`: Общее количество активных карточек.

#### 2. `passcard_info_view`

- **Описание**: Это представление отображает информацию о конкретной карточке доступа, включая историю визитов. Оно принимает `passcode` в качестве параметра URL и извлекает соответствующую карточку из базы данных.
- **URL**: `/passcard_info/<uuid:passcode>`
- **Контекст**:
  - `passcard`: Объект карточки доступа.
  - `this_passcard_visits`: Список визитов для данной карточки, включая время входа и продолжительность.

#### 3. `storage_information_view`

- **Описание**: Это представление отображает информацию о визитах, которые еще не были закрыты (т.е. у которых `leaved_at` равно `null`). Оно собирает данные о текущих визитах и передает их в шаблон для отображения.
- **URL**: `/storage_information`
- **Контекст**:
  - `non_closed_visits`: Список визитов, которые еще не завершены, включая информацию о владельце карточки, времени входа и продолжительности визита.



## Цель проекта
- Обучение. 


